<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <meta name="author" content="CozyCloud - https://cozy.io">
        <link rel="canonical" href="https://docs.cozy.io/dev/app/">
        <link rel="shortcut icon" href="../../img/favicon.png">
        
        <title>app - Documentation</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
            <link href="../../css/extra.css" rel="stylesheet">
            <link href="../../css/highlight_theme.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://docs.cozy.io/">Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Install <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../install/">Install Cozy on your own server</a>
</li>
                            
<li >
    <a href="../../install/debian/">Debian</a>
</li>
                            
<li >
    <a href="../../install/manual/">Manual installation</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Develop <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../">Let's hack some code</a>
</li>
                            
<li >
    <a href="../connect-mobile-app-local-stack/">Connect a mobile app to your local stack</a>
</li>
                            
<li >
    <a href="../intro/">Architecture</a>
</li>
                            
<li >
    <a href="./">Create your first app</a>
</li>
                            
<li >
    <a href="../konnector/">Develop a connector</a>
</li>
                            
<li >
    <a href="../cordova/">Create a mobile app with cordova</a>
</li>
                            
<li >
    <a href="../git-flow/">Git Flow</a>
</li>
                            
<li >
    <a href="../sendmail/">How to send mail in development</a>
</li>
                            
  <li class="dropdown-submenu">
    <a href="#">References</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">cozy-client-js</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-client-js/README/">README</a>
</li>
            
<li >
    <a href="../../cozy-client-js/intro/">Introduction</a>
</li>
            
<li >
    <a href="../../cozy-client-js/browser-sdk-transition/">Transition from cozy-browser-sdk</a>
</li>
            
<li >
    <a href="../../cozy-client-js/offline/">How to support offline</a>
</li>
            
<li >
    <a href="../../cozy-client-js/oauth/">OAuth guide</a>
</li>
            
<li >
    <a href="../../cozy-client-js/auth-api/">Authentication API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/data-api/">Data System API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/files-api/">Files API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/jobs-api/">Jobs API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/intents-api/">Intents API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/settings-api/">Settings API</a>
</li>
            
<li >
    <a href="../../cozy-client-js/sharing-api/">Sharing API</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-konnector-libs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-konnector-libs/api/">API</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/cli/">CLI</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/dev/">Develop</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/errors/">Errors</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/operation-linking/">Operation linking</a>
</li>
            
<li >
    <a href="../../cozy-konnector-libs/synchronization/">Synchronization</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-doctypes</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-doctypes/docs/README/">README</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.accounts/">Accounts</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.photos.albums/">Albums</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.bank/">Banking doctypes</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.bills/">Bills</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.konnectors/">Connectors</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.contacts/">Contacts</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.files/">Files</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.notifications/">Notifications</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.payslips/">Payslips</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.remote.requests/">Remote requests</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.sessions.logins/">Session logins</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.sharings/">Sharings</a>
</li>
            
<li >
    <a href="../../cozy-doctypes/docs/io.cozy.triggers/">Triggers</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-stack</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/README/">README</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Architecture</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/architecture/">General overview</a>
</li>
            
<li >
    <a href="../../cozy-stack/security/">Security</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Usage</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/INSTALL/">Install the cozy-stack</a>
</li>
            
<li >
    <a href="../../cozy-stack/cli/cozy-stack/">Manpages of the command-line tool</a>
</li>
            
<li >
    <a href="../../cozy-stack/config/">Configuration file</a>
</li>
            
<li >
    <a href="../../cozy-stack/instance/">Managing Instances</a>
</li>
            
<li >
    <a href="../../cozy-stack/onboarding/">Onboarding</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">For developpers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/client-app-dev/">Develop a client-side app</a>
</li>
            
<li >
    <a href="../../cozy-stack/docker/">Running and building Docker images</a>
</li>
            
<li >
    <a href="../../cozy-stack/release/">Build a release</a>
</li>
            
<li >
    <a href="../../cozy-stack/CONTRIBUTING/">The contributing guide</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Services</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-stack/auth/">/auth - Authentication & OAuth</a>
</li>
            
<li >
    <a href="../../cozy-stack/apps/">/apps - Applications Management</a>
</li>
            
<li >
    <a href="../../cozy-stack/registry/">Apps registry</a>
</li>
            
<li >
    <a href="../../cozy-stack/data-system/">/data - Data System</a>
</li>
            
<li >
    <a href="../../cozy-stack/mango/">Mango</a>
</li>
            
<li >
    <a href="../../cozy-stack/replication/">Replication</a>
</li>
            
<li >
    <a href="../../cozy-stack/couchdb-quirks/">CouchDB Quirks</a>
</li>
            
<li >
    <a href="../../cozy-stack/pouchdb-quirks/">PouchDB Quirks</a>
</li>
            
<li >
    <a href="../../cozy-stack/files/">/files - Virtual File System</a>
</li>
            
<li >
    <a href="../../cozy-stack/references-docs-in-vfs/">References of documents in VFS</a>
</li>
            
<li >
    <a href="../../cozy-stack/intents/">/intents - Intents</a>
</li>
            
<li >
    <a href="../../cozy-stack/jobs/">/jobs Jobs</a>
</li>
            
<li >
    <a href="../../cozy-stack/konnectors/">Konnectors</a>
</li>
            
<li >
    <a href="../../cozy-stack/workers/">Workers</a>
</li>
            
<li >
    <a href="../../cozy-stack/move/">/move - Move, export and import an instance</a>
</li>
            
<li >
    <a href="../../cozy-stack/notifications/">/notifications - Notifications</a>
</li>
            
<li >
    <a href="../../cozy-stack/permissions/">/permissions - Permissions</a>
</li>
            
<li >
    <a href="../../cozy-stack/realtime/">/realtime - Realtime</a>
</li>
            
<li >
    <a href="../../cozy-stack/remote/">/remote - Proxy for remote data/API</a>
</li>
            
<li >
    <a href="../../cozy-stack/settings/">/settings - Settings</a>
</li>
            
<li >
    <a href="../../cozy-stack/sharing/">/sharings - Sharing</a>
</li>
            
<li >
    <a href="../../cozy-stack/sharing-design/">Request for comments</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">konitor</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../konitor/cli/">CLI</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-app-publish</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-app-publish/README/">CLI & Workflow</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">cozy-client</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../cozy-client/guide/">Usage guide</a>
</li>
            
<li >
    <a href="../../cozy-client/api/">API</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Synchronize <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../sync/linux/">Install Cozy Drive on GNU/Linux</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li>
                        <a href="https://github.com/cozy/cozy.github.io/">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3">
<div class="bs-sidebar hidden-print affix" role="complementary">
    <ul class="nav bs-sidenav well" style='padding-left: 0; padding-right: 0; margin-bottom: 1.5rem'>
        <li class="main active"><a href="#how-to-create-your-first-cozy-application">How to create your first Cozy application</a></li>
            <li><a href="#prerequisite">Prerequisite</a></li>
            <li><a href="#install-the-development-environment">Install the development environment</a></li>
            <li><a href="#create-your-application">Create your application</a></li>
            <li><a href="#how-is-the-application-working">How is the application working?</a></li>
            <li><a href="#use-the-api-with-cozy-client-js">Use the API with cozy-client-js</a></li>
            <li><a href="#read-the-manifest">Read the manifest</a></li>
            <li><a href="#manipulating-documents-with-cozy-client">Manipulating documents with cozy-client</a></li>
            <li><a href="#discover-the-cozy-bar">Discover the Cozy Bar</a></li>
            <li><a href="#style-with-cozy-ui">Style with Cozy UI</a></li>
            <li><a href="#use-docker">Use Docker</a></li>
    </ul>
  <div style='padding-left: 2rem'>
    
    <a id='edit-link' href='https://github.com/cozy/cozy.github.io/edit/dev/src/dev/app.md'>Edit documentation</a>
    <script type='text/javascript'>
        /* Here we detect if the current page is from an external documentation and we 
        change the href of the editing link so it goes to the right repository and file */
        const outsideDocs = [{"repo": "https://github.com/cozy/cozy-client-js.git", "name": "cozy-client-js", "subdir": "docs"}, {"repo": "https://github.com/konnectors/libs.git", "name": "cozy-konnector-libs", "subdir": "packages/cozy-konnector-libs/docs"}, {"repo": "https://github.com/cozy/cozy-doctypes.git", "name": "cozy-doctypes", "subdir": "."}, {"repo": "https://github.com/cozy/cozy-stack.git", "name": "cozy-stack", "subdir": "docs"}, {"repo": "https://github.com/konnectors/konitor.git", "name": "konitor", "subdir": "docs"}, {"repo": "https://github.com/cozy/cozy-app-publish.git", "name": "cozy-app-publish", "subdir": "."}, {"repo": "https://github.com/cozy/cozy-client.git", "name": "cozy-client", "subdir": "docs"}]
        const editNode = document.querySelector('#edit-link')
        const pathname = window.location.pathname
        const editURI = 'edit/master/'
        const removeGitSuffix = function (x) { return x.replace(/\.git$/, '') }

        // Returns the external repo associated to a pathname
        const detectExternalRepo = function (pathname) {
            for (var outsideDoc of outsideDocs) {
                if (window.location.pathname.includes('/' + outsideDoc.name + '/')) {
                    return outsideDoc
                }
            }
        }

        // Change the href attribute of a link to point to the correct edition page on GitHub
        // for the passed external documentation
        const fixEditLink = function (editNode, externalDoc) {
            const repoFile = pathname.replace('/en/' + externalDoc.name, '').replace(/\/$/, '.md')
            const baseRepo = removeGitSuffix(externalDoc.repo)
            editNode.href = baseRepo + '/' + editURI + externalDoc.subdir + repoFile
        }

        const externalRepo = detectExternalRepo(pathname)
        if (externalRepo) {
            fixEditLink(editNode, externalRepo)
        }
    </script>
    
  </div>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="how-to-create-your-first-cozy-application">How to create your first Cozy application<a class="headerlink" href="#how-to-create-your-first-cozy-application" title="Permanent link">&para;</a></h1>
<h2 id="prerequisite">Prerequisite<a class="headerlink" href="#prerequisite" title="Permanent link">&para;</a></h2>
<p>Developing an application for Cozy is quite easy. All you need to have is:</p>
<ul>
<li>NodeJS 8+</li>
<li><a href="https://yarnpkg.com">Yarn</a>: a NodeJS package manager, like <code>npm</code></li>
<li>Docker to have a Cozy for dev</li>
<li>Some basics about developing a single page application in HTML/JS or you just want to learn :)</li>
</ul>
<p>The only tool required to have a Cozy for development is Docker. We have been told that installing Docker on some familial flavours of Windows may be a bit difficult. If you use Windows, please check if Docker is available on your system.</p>
<h2 id="install-the-development-environment">Install the development environment<a class="headerlink" href="#install-the-development-environment" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p>On GNU/Linux, according <a href="https://docs.docker.com/engine/installation/linux/linux-postinstall/">to the documentation</a>: « The docker daemon binds to a Unix socket instead of a TCP port. By default that Unix socket is owned by the user root and other users can only access it using sudo. If you don’t want to use sudo when you use the docker command, create a Unix group called docker and add users to it. Be warned that the docker group grants privileges equivalent to the root user. You should have a look at <a href="https://docs.docker.com/engine/security/security/">Docker’s documentation on security</a>.</p>
</div>
<p>Every application running inside Cozy is a client-side HTML5 application interacting with your data through the API of the server. To develop an application, you’ll require a running Cozy server.</p>
<p>The easiest way is to use the Docker image for developers we provide.</p>
<p>Just install it:</p>
<pre class="codehilite"><code class="language-sh">docker pull cozy/cozy-app-dev</code></pre>


<p>(We update this image on a regular basis with the latest version of the server and our library. Don’t forget to update the image by running <code>docker pull cozy/cozy-app-dev</code> from time to time).</p>
<h2 id="create-your-application">Create your application<a class="headerlink" href="#create-your-application" title="Permanent link">&para;</a></h2>
<p>You can boostrap your application from scratch if you want, but we recommand to use our new community tool <a href="https://github.com/CPatchane/create-cozy-app"><code>create-cozy-app</code></a> to bootstrap very easily a Cozy application for you.</p>
<div align="center">
  <img src="https://github.com/CPatchane/create-cozy-app/blob/master/docs/CCA_logo_wording.png?raw=true" height="150px"/>
</div>

<p>This tool will generate an application using (P)React, the framework we internally use in the Cozy Front team. But <a href="https://github.com/CPatchane/create-cozy-app#options">options</a> are available if you want to use other frameworks.</p>
<div class="admonition warning">
<p>For now the new <a href="https://github.com/cozy/cozy-client"><code>cozy-client</code></a> is used only in the (P)React template (it doesn&rsquo;t use the previous <code>cozy-client-js</code> anymore). This library is at an early stage but you can use it, it will be our next Cozy client for application development.</p>
</div>
<p>First of all, run directly <code>create-cozy-app</code> without installing it globally by using the <code>yarn create cozy-app</code> command to bootstrap your application:</p>
<pre class="codehilite"><code>yarn create cozy-app mycozyapp</code></pre>


<p>The script will download some dependencies (may take a while) and ask you a few questions, then create an application skeleton inside <code>mycozyapp</code>.</p>
<p>That&rsquo;s all! You can start hacking:</p>
<pre class="codehilite"><code>cd mycozyapp
yarn standalone</code></pre>


<p>After the webpack build, your app should be available at http://localhost:8888</p>
<blockquote>
<p>You can change the host and the port of your application server here by using respectively the environment variables DEV_HOST and DEV_PORT</p>
</blockquote>
<h3 id="run-it-inside-a-cozy-using-docker">Run it inside a Cozy using Docker<a class="headerlink" href="#run-it-inside-a-cozy-using-docker" title="Permanent link">&para;</a></h3>
<p>You can run your application (here <code>mycozyapp</code>) inside a Cozy thanks to the [cozy-stack docker image][cozy-stack-docker]:</p>
<pre class="codehilite"><code class="language-sh"># in a terminal, run your app in watch mode
$ cd mycozyapp
$ yarn watch</code></pre>


<p>Then, in another terminal:</p>
<pre class="codehilite"><code class="language-sh"># in another terminal, run the docker container
$ yarn stack:docker
# or if you want the complete command (see more documentation below)
$ docker run --rm -it -p 8080:8080 -v &quot;$(pwd)/build&quot;:/data/cozy-app/mycozyapp cozy/cozy-app-dev</code></pre>


<p>Your app is now available at http://mycozyapp.cozy.tools:8080.</p>
<h2 id="how-is-the-application-working">How is the application working?<a class="headerlink" href="#how-is-the-application-working" title="Permanent link">&para;</a></h2>
<p>The minimal application consist of only two files:</p>
<ul>
<li>an HTML file, <code>index.html</code>, with the markup and the code of your application</li>
<li>a manifest describing the application. It’s a JSON file named <code>manifest.webapp</code> with the name of the application, the permissions it requires… We’ll have a deeper look to it content later.</li>
</ul>
<p>Your application requires some informations to interact with the server API, for example the URL of its entrypoint, and an auth token. This data will be dynamically injected into <code>index.html</code> when it serves the page. So the <code>index.html</code> file has to contain some string that will be replaced by the server. The general syntax of this variables is <code>{{…}}</code>, so don’t use this syntax for other purpose in the page, for example inside comments.</p>
<p>You can use the following variables:</p>
<ul>
<li><code>{{.Domain}}</code> will be substituted by the URL of the API entrypoint</li>
<li><code>{{.Token}}</code> will be replaced by a token that authenticate your application when accessing the API</li>
<li><code>{{.Locale}}</code>: the lang f the instance</li>
<li><code>{{.AppName}}</code>: the name of the application</li>
<li><code>{{.IconPath}}</code> will be replaced by HTML code to display the <em>favicon</em></li>
<li><code>{{.CozyClientJS}}</code> will be replaced with HTML code to inject the Cozy client library</li>
<li><code>{{.CozyBar}}</code> will be replaced with HTML code to inject the upper menu bar.</li>
</ul>
<h2 id="use-the-api-with-cozy-client-js">Use the API with cozy-client-js<a class="headerlink" href="#use-the-api-with-cozy-client-js" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p>We are currently working on a new <a href="https://github.com/cozy/cozy-client"><code>cozy-client</code></a> library which will be more updated and used in the future than <code>cozy-client-js</code>. But the two libraries (<code>cozy-client</code> and <code>cozy-client-js</code>) don&rsquo;t rely on each other so you can still use the one you want to handle Cozy data for now.</p>
</div>
<p>If you added <code>{{.CozyClientJS}}</code> to your page, interacting with the server will be as easy as using the Cozy Client JS library. All you have to do is to initiate the library with the server parameters (the URL of the API and the auth token of your application):</p>
<pre class="codehilite"><code class="language-js">  window.cozy.client.init({cozyURL: &quot;…&quot;, token: &quot;…&quot;});</code></pre>


<p>You can then interact with the server by using methods of the <code>window.cozy.client</code> properties. For example, to get current disk usage:</p>
<pre class="codehilite"><code class="language-javascript">  cozy.client.settings.diskUsage()
    .then(function (usage) {console.log(&quot;Usage (promise)&quot;, usage);});
    .catch(function(err){ console.log(&quot;fail&quot;, err); });</code></pre>


<p>This library embeds most of the available server APIs: manipulate documents and files, manage applications and server settings… It also provides some some methods to help application keep working while being offline.</p>
<p>Some server APIs may not be available right now through the library. If you want to use one of this method, you’ll have to call it manually. See below. #TODO - add inner link.</p>
<h4 id="behind-the-magic">Behind the magic<a class="headerlink" href="#behind-the-magic" title="Permanent link">&para;</a></h4>
<p>Some server APIs may not be available right now through the library. If you want to use one of this method, you’ll have to call it manually. We’ll describe here how to access the API without using the Cozy Client JS library.</p>
<p>Connecting to the API requires three things:</p>
<ul>
<li>its URL, injected into the page through the <code>{{.Domain}}</code> variable</li>
<li>the application auth token, injected into the page through the <code>{{.Token}}</code> variable. Each request sent to the server must include this token in the <code>Authorization</code> header</li>
<li>the session cookie, created when you connect to your server. This is an <code>HttpOnly cookie</code>, meaning that JavaScript applications can’t read it. This prevent a malicious script to stole the cookie.</li>
</ul>
<p>Here’s a sample code that get API informations provided by the server and query the API:</p>
<pre class="codehilite"><code class="language-html">    &lt;div data-cozy-token=&quot;{{.Token}}&quot; data-cozy-domain=&quot;{{.Domain}}&quot; /&gt;</code></pre>


<pre class="codehilite"><code class="language-javascript">document.addEventListener('DOMContentLoaded', () =&gt; {
  &quot;use strict&quot;;
  const app = document.querySelector('[data-cozy-token]');
  fetch(`//${app.dataset.cozyDomain}/apps`,
  {
    method: 'GET',
    headers: {
      Authorization: `Bearer ${app.dataset.cozyToken}` // Here we use the auth token
    },
    credentials: 'include' // don’t forget to include the session cookie
  })
  .then(function (response) {
    if (response.ok) {
      response.json().then((result) =&gt; {
        console.log(result);
      });
    } else {
      throw new Error('Network response was not ok.');
    }
  })
  .catch(function (error) {
    console.log('There has been a problem with your fetch operation: ' + error.message);
  });
});</code></pre>


<h2 id="read-the-manifest">Read the manifest<a class="headerlink" href="#read-the-manifest" title="Permanent link">&para;</a></h2>
<p>Each application must have a “manifest”. It’s a JSON file named <code>manifest.webapp</code> stored at the root of the application directory. It describes the application, the type of documents it uses, the permissions it require…</p>
<p>Here’s a sample manifest:</p>
<pre class="codehilite"><code class="language-json">{
  &quot;name&quot;: &quot;My Awesome application&quot;,
  &quot;permissions&quot;: {
    &quot;apps&quot;: {
      &quot;type&quot;: &quot;io.cozy.apps&quot;
    },
    &quot;permissions&quot;: {
      &quot;type&quot;: &quot;io.cozy.permissions&quot;
    },
    &quot;settings&quot;: {
      &quot;type&quot;: &quot;io.cozy.settings&quot;
    },
    &quot;sample&quot;: {
      &quot;type&quot;: &quot;io.cozy.dev.sample&quot;,
      &quot;verbs&quot;: [&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;PATCH&quot;, &quot;DELETE&quot;]
    },
    &quot;jobs&quot;: {
      &quot;type&quot;: &quot;io.cozy.jobs&quot;
    }
  },
  &quot;routes&quot;: {
    &quot;/&quot;: {
      &quot;folder&quot;: &quot;/&quot;,
      &quot;index&quot;: &quot;index.html&quot;,
      &quot;public&quot;: false
    },
    &quot;/public&quot;: {
      &quot;folder&quot;: &quot;/public&quot;,
      &quot;index&quot;: &quot;index.html&quot;,
      &quot;public&quot;: true
    }
  }
}</code></pre>


<h3 id="permissions">Permissions<a class="headerlink" href="#permissions" title="Permanent link">&para;</a></h3>
<p>Applications require permissions to use most of the APIs. Permissions can be described inside the manifest, so the server can ask the user to grant them during installation. Applications can also request permissions at run time.</p>
<p>A permission must at type contain a target, the type of objects the application want to interact with. Can be a document type, or an action on the server. By default, all grant on this object are granted, but we can also request fine grained permissions, for example limiting to read access. We can also limit the scope to a subset of the documents.</p>
<p>In the manifest, each permission is an object, with a random name and some properties:</p>
<ul>
<li><code>type</code>: <strong>mandatory</strong> the document type or action name</li>
<li><code>description</code>: a text that will be displayed to the user to explain why the application require this permission</li>
<li><code>verbs</code>: an array of HTTP verbs. For example, to limit permissions to read access, use <code>["GET"]</code></li>
<li><code>selector</code>: a document attribute to limit access to a subset of documents</li>
<li><code>values</code>: array of allowed values for this attribute.</li>
</ul>
<p>An application can request a token that grant access to a subset of its own permissions. For example if the application has full access to the files, it can obtain a token that give only read access on a file. Thus, the application can make some documents publicly available. The public page of the application will use this token as authentication token when accessing the API.</p>
<h4 id="samples">Samples<a class="headerlink" href="#samples" title="Permanent link">&para;</a></h4>
<p>Application require full access to files:</p>
<pre class="codehilite"><code class="language-json">{
  &quot;permissions&quot;: {
    &quot;files&quot;: {
      &quot;description&quot;: &quot;…&quot;,
      &quot;type&quot;: &quot;io.cozy.files&quot;
    },
  }
}</code></pre>


<p>Application want to be able to read the contact informations of <code>cozy@cozycloud.cc</code></p>
<pre class="codehilite"><code class="language-json">{
  &quot;permissions&quot;: {
    &quot;contact&quot;: {
      &quot;type&quot;: &quot;io.cozy.contacts&quot;,
      &quot;verbs&quot;: [&quot;GET&quot;],
      &quot;selector&quot;: &quot;email&quot;,
      &quot;values&quot;: [&quot;cozy@cozycloud.cc&quot;]
    }
  }
}</code></pre>


<h3 id="routing">Routing<a class="headerlink" href="#routing" title="Permanent link">&para;</a></h3>
<p>The application must declare all of its URLs (routes) inside the manifest. A route is an object associating an URL to an HTML file. Each route has the following properties:</p>
<ul>
<li><code>folder</code>: the base folder of the route</li>
<li><code>index</code>: the name of the file inside this folder</li>
<li><code>public</code>: a boolean specifying whether the route is public or private (default).</li>
</ul>
<p>Sample:</p>
<pre class="codehilite"><code class="language-json">&quot;routes&quot;: {
  &quot;/admin&quot;: {
    &quot;folder&quot;: &quot;/&quot;,
    &quot;index&quot;: &quot;admin.html&quot;,
    &quot;public&quot;: false
  },
  &quot;/public&quot;: {
    &quot;folder&quot;: &quot;/public&quot;,
    &quot;index&quot;: &quot;index.html&quot;,
    &quot;public&quot;: true
  },
  &quot;/assets&quot;: {
    &quot;folder&quot;: &quot;/assets&quot;,
    &quot;public&quot;: true
  }
}</code></pre>


<h2 id="manipulating-documents-with-cozy-client">Manipulating documents with <code>cozy-client</code><a class="headerlink" href="#manipulating-documents-with-cozy-client" title="Permanent link">&para;</a></h2>
<p><code>cozy-client</code> is a simple and declarative way of managing <a href="https://github.com/cozy/cozy-stack">cozy-stack</a> API calls and resulting data. It is a convenient yet powerful way to bind <code>cozy-stack</code> queries to your components.</p>
<ul>
<li><a href="https://docs.cozy.io/en/cozy-client/guide/">User guide</a></li>
<li><a href="https://docs.cozy.io/en/cozy-client/api/">API docs</a></li>
</ul>
<h2 id="discover-the-cozy-bar">Discover the Cozy Bar<a class="headerlink" href="#discover-the-cozy-bar" title="Permanent link">&para;</a></h2>
<p>The <a href="https://github.com/cozy/cozy-bar">Cozy Bar</a> is a component that display the Cozy menu on the top of your application and allow inter-apps features like content sharing.</p>
<p>Your application interacts with this component through <code>cozy-bar.js</code>, a library injected into your pages by the server when you add <code>{{.CozyBar}}</code> in the header. It exposes an API behind the window.cozy.bar namespace.</p>
<p>Before using it, you have to initialize the library: <code>window.cozy.bar.init({appName: "Mon application"})</code>.</p>
<h2 id="style-with-cozy-ui">Style with Cozy UI<a class="headerlink" href="#style-with-cozy-ui" title="Permanent link">&para;</a></h2>
<p>If you plan to build a webapp to run on Cozy, you’ll probably want to use a simple and elegant solution to build your interfaces without the mess of dealing with complex markup and CSS. Then <a href="https://github.com/cozy/cozy-ui/">Cozy UI</a> is here for you!</p>
<p>It relies on Stylus as preprocessor. You can add it as a library in your project to use it out-of-the-box.</p>
<h2 id="use-docker">Use Docker<a class="headerlink" href="#use-docker" title="Permanent link">&para;</a></h2>
<p><em>(remember what we previously said about the permissions required to run Docker: if your user doesn’t belong to the docker group, you’ll have to use <code>sudo</code> to run each of this commands.)</em></p>
<p>To run your application inside the development server, just run the following command from the folder where your <code>index.html</code> and <code>manifest.webapp</code> files leave:</p>
<pre class="codehilite"><code class="language-sh">docker run --rm -it -p 8080:8080 -p 5984:5984 -p 8025:8025 -v $(pwd):/data/cozy-app --name cozydev cozy/cozy-app-dev</code></pre>


<p>Let’s have a quick look at this command, so you can adapt it to your needs:</p>
<ul>
<li><code>--rm</code> will delete the server when you stop it. This prevent Docker from keeping a lot of unused stopped images</li>
<li><code>-it</code> allow to attach an interactive terminal, so you’ll be able to use the command line inside the server</li>
<li><code>-p 8080:8080</code>: the server listens on port 8080 on the virtual machine. We forward this port to the same port on your local machine. To use another local port, for example 9090, use <code>-p 9090:8080</code></li>
<li><code>-p 5984:5984</code>: this is just a convenient way to access the CouchDB database running inside the server. Point your browser to <code>http://cozy.tools:5984/_utils/</code> to access its administrative interface</li>
<li><code>-p 8025:8025</code> : Cozy requires a mail server. In the development image, we don’t use a real email server, but a software that can display the sent messages. Just point your browser to <code>http://cozy.tools:8025/</code> to display the messages sent by the server</li>
<li><code>-v $(pwd):/data/cozy-app</code> this mount the current folder, where your application leaves, inside the server. This is what make the application available on the server</li>
<li><code>--name cozydev</code> name the running virtual machine <code>cozydev</code>, so you can easily refer to it from other Docker commands. For example, if you want to connect to a shell inside the server, you can use <code>docker exec -ti /bin/bash</code></li>
</ul>
<p>With this syntax, there is no data persistance: all your test data will be lost every time you stop the server. This is a good way to prevent side effects and start on a clean base, with an empty database.</p>
<p>However, if you want to persist data, you have to mount two folders from the virtual server to local folders: <code>/usr/local/couchdb/data</code> (database) and <code>/data/cozy-storage</code> (the virtual filesystem). This can be achieved by adding to the command line <code>-v ~/cozy/data/db:/usr/local/couchdb/data -v ~/cozy/data/storage:/data/cozy-storage</code> which will store the server’s data into <code>~/cozy/data</code>.</p>
<p>Once the server started, go to <code>http://app.cozy.tools:8080/#</code>, connect to the server with the default password <code>cozy</code> and you should be able to start testing your application.</p>
<p>You can also access the following URLs:</p>
<ul>
<li><code>http://cozy.tools:5984/_utils</code> to get the database administrative panel</li>
<li><code>http://cozy.tools:8025/</code> to display the emails sent by the server.</li>
</ul>
<h3 id="test-multiple-applications">Test multiple applications<a class="headerlink" href="#test-multiple-applications" title="Permanent link">&para;</a></h3>
<p>You can install more than one application into the development server, for example to test communication between applications. In order to achieve this, you have to mount the folder where your application leaves into subfolders of <code>/data/cozy-apps</code>. For example, if the code of Cozy Drive and Cozy Photos is on your local filesystem in <code>~/cozy/drive</code> and <code>~/cozy/photos</code>, start the development server with:</p>
<pre class="codehilite"><code class="language-sh">docker run --rm -it -p 8080:8080 -p 5984:5984 -p 8025:8025 -v &quot;~/cozy/drive:/data/cozy-app/drive&quot; -v &quot;~/cozy/photos:/data-cozy-app/photos&quot; --name=cozydev cozy/cozy-app-dev</code></pre>


<p>You’ll access the applications by connecting to <code>http://drive.cozy.tools:8080/</code> and <code>http://photos.cozy.tools:8080</code>.</p>
<h3 id="what-is-cozytools">What is <code>cozy.tools</code> ?<a class="headerlink" href="#what-is-cozytools" title="Permanent link">&para;</a></h3>
<p>This development server use the domain names <code>*.cozy.tools</code>. We have parameterized this domain to always redirect to <code>127.0.0.1</code>, your local computer address. With that, no need to configure your environment to set extra local hosts for development anymore.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <!-- Piwik -->
        <script type="text/javascript">
          var _paq = _paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
            var u="//piwik.cozycloud.cc/";
            _paq.push(['setTrackerUrl', u+'piwik.php']);
            _paq.push(['setSiteId', '7']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
          })();
        </script>
        <noscript><p><img src="//piwik.cozycloud.cc/piwik.php?idsite=7&rec=1" style="border:0;" alt="" /></p></noscript>
        <!-- End Piwik Code -->
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../extra.js"></script>
        <script src="../../search/main.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
